# Example Projects

Before running these tests, generate EvoSuite JAR: `mvn clean package -DskipTests`.

There is a total of 5 examples, 4 working and 1 non working (more to be added):

- **Internal**
  - *Description*: a class A calls class B that has the vulnerability
  - *Generate suite*:
    1. Move into its directory: `examples/ex1-internal`
    2. Build the project: `mvn compile` is enough
    3. Run EvoSuite with these settings: `java -jar ../../master/target/evosuite-master-1.0.7-SNAPSHOT.jar -generateSuite -criterion vulnerability -Dinstrument_context=true -Dinstrument_method_calls=true -projectCP target/classes -class org.example.MyCUTCallsJARDirectly -DvulnClass="org.example.VulnerableClassJAR" -DvulnMethod="vulnerableMethod(Ljava/lang/String;)V" -DvulnLine="23"`
- **Jar Direct**
  - *Description*: a class A calls class B (in a JAR) that has the vulnerability
  - *Generate suite*:
    1. Move into its directory: `examples/ex2-jar-direct`
    2. Build the project: `mvn compile` is enough
    3. Run EvoSuite with these settings: `java -jar ../../master/target/evosuite-master-1.0.7-SNAPSHOT.jar -generateSuite -criterion vulnerability -Dinstrument_context=true -Dinstrument_method_calls=true -projectCP target/classes:target/classes/VulnerableLibrary-1.0-SNAPSHOT.jar -class org.example.MyCUTCallsJARDirectly -DvulnClass="org.example.VulnerableClassJAR" -DvulnMethod="vulnerableMethod(Ljava/lang/String;)V" -DvulnLine="23"`
- **Jar Indirect**
  - *Description*: a class A calls class B (in a JAR), and B calls class C in a second JAR and has the vulnerability
  - *Generate suite*:
    1. Move into its directory: `examples/ex3-jar-indirect`
    2. Build the project: `mvn compile` is enough
    3. Run EvoSuite with these settings: `java -jar ../../master/target/evosuite-master-1.0.7-SNAPSHOT.jar -generateSuite -criterion vulnerability -Dinstrument_context=true -Dinstrument_method_calls=true -projectCP target/classes:target/classes/common-library-1.0-SNAPSHOT.jar:target/classes/VulnerableLibrary-1.0-SNAPSHOT.jar -class org.example.MyCUTCallsJARIndirectly -DvulnClass="org.example.VulnerableClassJAR" -DvulnMethod="vulnerableMethod(Ljava/lang/String;)V" -DvulnLine="23"`
- **Jar Direct w/ Hierarchy V1**
  - *Description*: a class A calls class B1 (in JAR), a subclass of B (with the vulnerability and in same JAR too). B1 explicitly call the vulnerable target.
  - *Generate suite*:
    1. Move into its directory: `examples/ex4-jar-direct-hierarchy-v1`
    2. Build the project: `mvn compile` is enough
    3. Run EvoSuite with these settings: `java -jar ../../master/target/evosuite-master-1.0.7-SNAPSHOT.jar -generateSuite -criterion vulnerability -Dinstrument_context=true -Dinstrument_method_calls=true -projectCP target/classes:target/classes/vulnerable-hierarchy-1.0-SNAPSHOT.jar -class org.example.MyCUTCallsJARDirectlyHierarchy -DvulnClass="org.example.hierarchy.VulnerableSuper" -DvulnMethod="vulnerableMethod(Ljava/lang/String;)V" -DvulnLine="23"`
- **Jar Direct w/ Hierarchy V2**
  - *Description*: a class A calls class B1 (in JAR), a subclass of B (with the vulnerability and in same JAR too). B1 implicitly call the vulnerable target.
  - *Generate suite*:
    1. Move into its directory: `examples/ex4-jar-direct-hierarchy-v2`
    2. Build the project: `mvn compile` is enough
    3. Run EvoSuite with these settings: `java -jar ../../master/target/evosuite-master-1.0.7-SNAPSHOT.jar -generateSuite -criterion vulnerability -Dinstrument_context=true -Dinstrument_method_calls=true -projectCP target/classes:target/classes/vulnerable-hierarchy-1.0-SNAPSHOT.jar -class org.example.MyCUTCallsJARDirectlyHierarchy -DvulnClass="org.example.hierarchy.VulnerableSuper" -DvulnMethod="vulnerableMethod(Ljava/lang/String;)V" -DvulnLine="23"`

# Are there JUnit tests for the above examples?

Yes, and no.

I mean there are tests in `master/src/test/java/org/evosuite/basic/VulnerabilitySystemTest` class, but they do not use the example projects above but classes in `client/src/test/java/com/examples/with/different/packagename/myapp` package, that contains **exact copies** of the example classes. JARs have been added into client's *pom.xml* as well.

# Which problems should I expect?

1. **Jar Direct w/ Hierarchy V2** has a problem: `BadChild` class never references the effective vulnerable method, that is the one belonging to the superclass. In fact, it overrides `vulnerableMethod()` but it avoids calling `super.vulnerableMethod()` (as `GoodChild` in *Jar Direct w/ Hierarchy V1* does); moreover, `aMethod1()` references to this overridden method, not the superclass' one.  
  So, to summarize:
    - If a child class *overrides the target* method but calls `super.targetMethod()` it's fine, as expected;
    - If a child class *does not override the target* method but call `super.targetMethod()` it's fine, as expected;
    - If a child class *overrides the target* method but DOES NOT call `super.targetMethod()` it does not work, as expected.
    - If a child class *does not override the target* method, never calls `super.targetMethod()`, but calls `this.targetMethod()` (or simply `targetMethod()`) it DOES NOT work **as NOT expected, and I can't understand why**.  
I suspect there is a problem in EvoSuite with Inheritance Tree. A child successfully call superclass though *implicit super constructor* (`<init>`) AND by explicit reference with `super` keyword; however, purely inherited methods seems to be "ignored", but I think it should be like this :(
2. Evolution seems to be **very very slow in example 3 only** when run through JAR; however, when run with test in `VulnerabilitySystemTest`, it seems fine (I have encountered this problem while preparing these examples).

Among these two, **problem 1 is the most urgent and important**.
