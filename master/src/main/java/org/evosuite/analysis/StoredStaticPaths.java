package org.evosuite.analysis;

import org.evosuite.coverage.reachability.StaticPath;

import java.util.*;

public class StoredStaticPaths {
    private static final Map<String, Map<String, Set<StaticPath>>> staticPaths = new LinkedHashMap<>();

    public static Map<String, Map<String, Set<StaticPath>>> getStaticPaths() {
        return Collections.unmodifiableMap(staticPaths);
    }

    public static void addAllIfNotExists(Set<StaticPath> newStaticPaths) {
        for (StaticPath newStaticPath : newStaticPaths) {
            String className = newStaticPath.getFinalNode().getClassName();
            String methodName = newStaticPath.getFinalNode().getMethodName();
            Map<String, Set<StaticPath>> cachedStaticPathsToClass = staticPaths.get(className);
            if (cachedStaticPathsToClass == null) {
                Map<String, Set<StaticPath>> cachedStaticPathsToMethod = new LinkedHashMap<>();
                cachedStaticPathsToMethod.put(methodName, newStaticPaths);
                staticPaths.put(className, cachedStaticPathsToMethod);
            }
            if (cachedStaticPathsToClass != null && !cachedStaticPathsToClass.containsKey(methodName)) {
                cachedStaticPathsToClass.put(methodName, newStaticPaths);
            }
        }
    }

    public static Set<StaticPath> getStaticPathsToTarget(String className, String methodName) {
        Map<String, Set<StaticPath>> cachedStaticPathsToClass = staticPaths.get(className);
        if (cachedStaticPathsToClass != null && cachedStaticPathsToClass.containsKey(methodName)) {
            return cachedStaticPathsToClass.get(methodName);
        }
        return new LinkedHashSet<>();
    }

    public void clear() {
        staticPaths.clear();
    }
}
